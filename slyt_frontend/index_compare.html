<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple Report Page</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        h1 {
            text-align: center;
        }
        h2 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
            color: #f0f0f0; /* 浅色字体提高可读性 */
        }
        th {
            background-color: #f2f2f2;
            color: #000; /* 对于表头使用深色字体以保持对比度 */
        }
        body {
            padding: 0px;
            margin: 0px;
            font-family: "微软雅黑";
            background: #000d4a url('images/bg.jpg') center;
            background-size: cover;
            color: #fff;
            font-size: 12px;
        }
        #myPieChart {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
        }
        .chartjs-render-monitor {
            color: white; /* Improving legibility of the text on the chart */
        }
    </style>
</head>
<body>
    <h1>分析报告</h1>
    <br>
    <br>

    <h2>指标体系对比报告</h2>
    <p id="index1">1.达到中石化先进值的条数</p>
    <table id="reportTable1">
        <thead>
            <tr>
                <th onclick="sortTable('reportTable1', 0)">编号</th>
                <th onclick="sortTable('reportTable1', 1)">类别</th>
                <th onclick="sortTable('reportTable1', 2)">名称</th>
                <th onclick="sortTable('reportTable1', 3)">级别</th>
                <th onclick="sortTable('reportTable1', 4)">值</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>投资控制指标</td>
                <td>油田百万吨产能地面投资 </td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>2</td>
                <td>投资控制指标</td>
                <td>油田地面工程投资占比</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>3</td>
                <td>投资控制指标</td>
                <td>单井地面工程投资</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>4</td>
                <td>达标率指标</td>
                <td>原油自用率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>5</td>
                <td>达标率指标</td>
                <td>集输密闭率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
        </tbody>
    </table>
    <p id="index2">2.达到中石化平均值的条数</p>
    <table id="reportTable2">
        <thead>
            <tr>
                <th onclick="sortTable(0)">编号</th>
                <th onclick="sortTable(1)">类别</th>
                <th onclick="sortTable(2)">名称</th>
                <th onclick="sortTable(3)">级别</th>
                <th onclick="sortTable(4)">值</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>投资控制指标</td>
                <td>油田百万吨产能地面投资 </td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>2</td>
                <td>投资控制指标</td>
                <td>油田地面工程投资占比</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>3</td>
                <td>投资控制指标</td>
                <td>单井地面工程投资</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>4</td>
                <td>达标率指标</td>
                <td>原油自用率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>5</td>
                <td>达标率指标</td>
                <td>集输密闭率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
        </tbody>
    </table>
    <p id="index3">3.未达到中石化平均值的条数</p>
    <table id="reportTable3">
        <thead>
            <tr>
                <th onclick="sortTable(0)">编号</th>
                <th onclick="sortTable(1)">类别</th>
                <th onclick="sortTable(2)">名称</th>
                <th onclick="sortTable(3)">级别</th>
                <th onclick="sortTable(4)">值</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>投资控制指标</td>
                <td>油田百万吨产能地面投资 </td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>2</td>
                <td>投资控制指标</td>
                <td>油田地面工程投资占比</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>3</td>
                <td>投资控制指标</td>
                <td>单井地面工程投资</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>4</td>
                <td>达标率指标</td>
                <td>原油自用率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>5</td>
                <td>达标率指标</td>
                <td>集输密闭率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
        </tbody>
    </table>

    <p>4.饼图展示：各类别分布</p>
    <canvas id="myPieChart"></canvas>
    
    <p id="indexall">5.根据先进性分析，生产指标综合评分为80分</p>

    <script>
        function sortTable(tableId, columnIndex) {
            var table = document.getElementById(tableId);
            var rows = Array.from(table.rows).slice(1);
            var sorted = rows.sort(function(a, b) {
                var ax = a.cells[columnIndex].innerText.toLowerCase();
                var bx = b.cells[columnIndex].innerText.toLowerCase();
                return ax.localeCompare(bx);
            });
            sorted.forEach(function(row) {
                table.appendChild(row);
            });
        }

        var ctx = document.getElementById('myPieChart').getContext('2d');
        var myPieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['先进性指标', '达标率指标', '未达标率指标'],
                datasets: [{
                    label: '指标分布',
                    data: [20, 30, 50],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.6)',
                        'rgba(54, 162, 235, 0.6)',
                        'rgba(255, 206, 86, 0.6)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)'
                    ],
                    borderWidth: 1,
                    hoverBorderColor: 'rgba(255, 255, 255, 1)', // White border on hover
                    hoverBorderWidth: 3 // Thicker border on hover
                }]
            },
            options: {
                responsive: true,
                interaction: {
                    mode: 'nearest', // Interact with elements nearest to the mouse
                    intersect: true, // Interaction when intersecting with the element
                    axis: 'x'        // Horizontal axis interaction
                },
                plugins: {
                    legend: {
                        labels: {
                            font: {
                                size: 14
                            },
                            color: '#fff' // White color for better visibility on dark backgrounds
                        }
                    },
                    tooltip: {
                        enabled: true,
                        mode: 'index',
                        intersect: false,
                        bodyFont: { size: 14 },
                        backgroundColor: '#000', // Black background for tooltips
                        titleFont: { size: 16, weight: 'bold' },
                        titleMarginBottom: 10,
                        callbacks: {
                            labelTextColor: function() {
                                return 'white'; //  text color for tooltips
                            }
                        }
                    }
                },
                hover: {
                    mode: 'nearest',
                    intersect: true,
                    onHover: function(e, chartElement) {
                        e.native.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
                    }
                },
                animation: {
                    duration: 400, // General animation time
                    hover: {
                        animationDuration: 300 // Duration of animations when hovering an item
                    }
                }
            }
        });

        // 将数据填充到指定的表格中
        window.onload = function() {
            // 创建一个新的 XMLHttpRequest 对象
        var xhr = new XMLHttpRequest();

        // 设置请求方法和URL
        xhr.open("GET", "http://127.0.0.1:8081/index_compare", true);

        // 设置回调函数，处理响应
        xhr.onreadystatechange = function() {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    // 请求成功，解析返回的 JSON 数据
                    var data = JSON.parse(xhr.responseText);
                    console.log(data.advanced)
                    // 填充到第一个表格
                    fillTable(data.advanced, "reportTable1");
                    fillTable(data.mean, "reportTable2");
                    fillTable(data.unqualified, "reportTable3");
                    var paragraph = document.getElementById("index1");
                    // 修改 <p> 元素的内容
                    paragraph.innerText = "达到中石化先进指标数："+data.advanced.length;
                    var paragraph = document.getElementById("index2");
                    // 修改 <p> 元素的内容
                    paragraph.innerText = "达到中石化平均指标数："+data.mean.length;
                    var paragraph = document.getElementById("index3");
                    // 修改 <p> 元素的内容
                    paragraph.innerText = "未达到中石化平均指标数："+data.unqualified.length;
                    var total=data.advanced.length+data.mean.length+data.unqualified.length
                    myPieChart.data.datasets[0].data = [data.advanced.length/total*100, data.mean.length/total*100, data.unqualified.length/total*100];
// 更新图表
                    myPieChart.update();
                    var paragraph = document.getElementById("indexall");
                    // 修改 <p> 元素的内容
                    paragraph.innerText = "综上分析，对标中石化生产指标，本系统得分："+data.score+"分";
                } else {
                    // 请求失败，显示错误信息
                    console.error("发生错误：" + xhr.status);
                }
            }
        };

        // 发送请求
        xhr.send();
        };

        // 将数据填充到指定的表格中
        function fillTable(data, tableId) {
        var table = document.getElementById(tableId);
        var tbody = table.getElementsByTagName("tbody")[0];
        tbody.innerHTML = ""; // 清空表格内容
        for (var i = 0; i < data.length; i++) {
            var row = "<tr>";
            row += "<td>" + i+ "</td>";
            row += "<td>" + data[i].类别 + "</td>";
            row += "<td>" + data[i].指标名称 + "</td>";
            row += "<td>" + "一级" + "</td>";
            row += "<td>" + data[i].油区系统一级指标实际值 + "</td>";
            row += "</tr>";
            tbody.innerHTML += row;
        }
        }


    </script>
</body>
</html>














