<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple Report Page</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2"></script>

    <style>
        :root {
            --chart-margin: 100px; /* 可以修改这个值来控制图表之间的间距 */
        }
        h1, h2 {
            text-align: center;
        }
        #index1 {
            text-align: center; /* 使文字居中 */
            font-size: 20px; /* 设置字体大小为20px */
        }
        #index2 {
            text-align: center; /* 使文字居中 */
            font-size: 20px; /* 设置字体大小为20px */
        }
        #index3 {
            text-align: center; /* 使文字居中 */
            font-size: 20px; /* 设置字体大小为20px */
        }
        body {
            padding: 0;
            margin: 0;
            font-family: "微软雅黑";
            background: #000d4a url('images/bg.jpg') center;
            background-size: cover;
            color: #fff;
            font-size: 12px;
        }
        #charts {
            display: flex;
            justify-content: center;
            align-items: flex-start; /* 如果图表大小不一，可能需要调整对齐方式 */
            flex-wrap: wrap; /* 允许图表在较小屏幕上换行 */
            margin: 20px 0;
        }

        .chart-container {
            flex-basis: 50%; /* 控制基础占比，可适应不同屏幕 */
            max-width: 600px; /* 最大宽度限制 */
            margin: 10px var(--chart-margin);
            text-align: center; /* 文本居中对齐 */
            display: flex;
            flex-direction: column; /* 确保文本在图表下方 */
            align-items: center; /* 中心对齐canvas和文本 */
        }

        canvas {
            width: 200%; /* 全宽度但遵循最大宽度限制 */
            max-height: 500px; /* 最大高度，避免无限制增长 */
        }

        #myPieChart, #myLineChart {
            flex: 1 1 50%; /* Each chart takes up half of the flex container */
            max-width: 600px;
            margin: 10px var(--chart-margin);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
            color: #f0f0f0;
        }
        th {
            background-color: #f2f2f2;
            color: #000;
        }
        p {
            text-align: center;
            font-size: 20px;
        }
        #printButton {
            position: fixed;
            bottom: 20px;  /* 距离底部20像素 */
            right: 20px;   /* 距离右边20像素 */
            padding: 10px 20px; /* 按钮内部的填充 */
            font-size: 16px; /* 文字大小 */
            background-color: #4CAF50; /* 背景颜色 */
            color: white; /* 文字颜色 */
            border: none; /* 无边框 */
            border-radius: 5px; /* 圆角边框 */
            cursor: pointer; /* 鼠标悬停时显示指针 */
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); /* 添加阴影效果 */
            z-index: 1000; /* 确保按钮在最上层 */
        }

        #printButton:hover {
            background-color: #45a049; /* 鼠标悬停时的背景颜色变化 */
        }

        /* @page {
            size: A4;
            margin: 0;
        }

        body {
            width: 210mm;
            min-height: 297mm;
            margin: 20mm;
            color: black;
            display: block;
            overflow: hidden;
        }

        @media print {
            body {
                width: 100%;
                background: none;
                margin: 0;
                box-shadow: none;
            }
        } */

    </style>
</head>
<body>
    <h1>分析报告</h1>
    <h2>指标体系对比报告</h2>
    <div id="charts">
        <div class="chart-container">
            <canvas id="myLineChart"></canvas>
            <p>这是年度指标趋势的折线图。</p>
        </div>
        <div class="chart-container">
            <canvas id="myPieChart"></canvas>
            <p>这是指标分布的饼图。</p>
        </div>
    </div>
    <p id="index1">达到中石化先进值的条数</p>
    <table id="reportTable1">
        <thead>
            <tr>
                <th onclick="sortTable('reportTable1', 0)">编号</th>
                <th onclick="sortTable('reportTable1', 1)">类别</th>
                <th onclick="sortTable('reportTable1', 2)">名称</th>
                <th onclick="sortTable('reportTable1', 3)">级别</th>
                <th onclick="sortTable('reportTable1', 4)">值</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>投资控制指标</td>
                <td>油田百万吨产能地面投资 </td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>2</td>
                <td>投资控制指标</td>
                <td>油田地面工程投资占比</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>3</td>
                <td>投资控制指标</td>
                <td>单井地面工程投资</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>4</td>
                <td>达标率指标</td>
                <td>原油自用率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>5</td>
                <td>达标率指标</td>
                <td>集输密闭率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
        </tbody>
    </table>
    <p id="index2">达到中石化平均值的条数</p>
    <table id="reportTable2">
        <thead>
            <tr>
                <th onclick="sortTable(0)">编号</th>
                <th onclick="sortTable(1)">类别</th>
                <th onclick="sortTable(2)">名称</th>
                <th onclick="sortTable(3)">级别</th>
                <th onclick="sortTable(4)">值</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>投资控制指标</td>
                <td>油田百万吨产能地面投资 </td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>2</td>
                <td>投资控制指标</td>
                <td>油田地面工程投资占比</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>3</td>
                <td>投资控制指标</td>
                <td>单井地面工程投资</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>4</td>
                <td>达标率指标</td>
                <td>原油自用率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>5</td>
                <td>达标率指标</td>
                <td>集输密闭率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
        </tbody>
    </table>
    <p id="index3">未达到中石化平均值的条数</p>
    <table id="reportTable3">
        <thead>
            <tr>
                <th onclick="sortTable(0)">编号</th>
                <th onclick="sortTable(1)">类别</th>
                <th onclick="sortTable(2)">名称</th>
                <th onclick="sortTable(3)">级别</th>
                <th onclick="sortTable(4)">值</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>投资控制指标</td>
                <td>油田百万吨产能地面投资 </td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>2</td>
                <td>投资控制指标</td>
                <td>油田地面工程投资占比</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>3</td>
                <td>投资控制指标</td>
                <td>单井地面工程投资</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>4</td>
                <td>达标率指标</td>
                <td>原油自用率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
            <tr>
                <td>5</td>
                <td>达标率指标</td>
                <td>集输密闭率</td>
                <td>一级指标 </td>
                <td>1 </td>
            </tr>
        </tbody>
    </table>
    
    <button id="printButton" onclick="window.print();">打印报告</button>


    <script>
        function sortTable(tableId, columnIndex) {
            var table = document.getElementById(tableId);
            var rows = Array.from(table.rows).slice(1);
            var sorted = rows.sort(function(a, b) {
                var ax = a.cells[columnIndex].innerText.toLowerCase();
                var bx = b.cells[columnIndex].innerText.toLowerCase();
                return ax.localeCompare(bx);
            });
            sorted.forEach(function(row) {
                table.appendChild(row);
            });
        }
        var ctxLine = document.getElementById('myLineChart').getContext('2d');
        var myLineChart = new Chart(ctxLine, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: '指标趋势',
                    data: [65, 59, 80, 81, 56, 55],
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            font: {
                                size: 14,
                                family: 'Arial',
                                weight: 'bold'
                            },
                            color: '#ffffff'
                        }
                    },
                    title: {
                        display: true,
                        text: '年度指标趋势',
                        font: {
                            size: 16,
                            family: 'Arial',
                            weight: 'bold'
                        },
                        color: '#ffffff'
                    },
                    tooltip: {
                        bodyFont: {
                            size: 14,
                            family: 'Arial'
                        },
                        titleFont: {
                            size: 16,
                            family: 'Arial',
                            weight: 'bold'
                        },
                        backgroundColor: '#333333',
                        titleColor: '#ffffff',
                        bodyColor: '#ffffff'
                    },
                    annotation: {
                        annotations: {
                            line70: {
                                type: 'line',
                                yMin: 70,
                                yMax: 70,
                                borderColor: 'rgb(255, 99, 132)',
                                borderWidth: 2,
                            },
                            line80: {
                                type: 'line',
                                yMin: 80,
                                yMax: 80,
                                borderColor: 'rgb(54, 162, 235)',
                                borderWidth: 2,
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            color: '#ffffff',
                            font: {
                                size: 12,
                                family: 'Arial'
                            }
                        },
                        grid: {
                            color: 'rgba(255,255,255,0.2)'
                        }
                    },
                    y: {
                        ticks: {
                            color: '#ffffff',
                            font: {
                                size: 12,
                                family: 'Arial'
                            }
                        },
                        grid: {
                            color: 'rgba(255,255,255,0.2)'
                        }
                    }
                }
            }
        });


        var ctx = document.getElementById('myPieChart').getContext('2d');
        var myPieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['先进性指标', '达标率指标', '未达标率指标'],
                datasets: [{
                    label: '指标分布',
                    data: [20, 30, 50],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.6)',
                        'rgba(54, 162, 235, 0.6)',
                        'rgba(255, 206, 86, 0.6)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: {
                                size: 14,
                                family: 'Arial',
                                weight: 'bold'
                            },
                            color: '#ffffff'
                        }
                    },
                    tooltip: {
                        bodyFont: {
                            size: 14,
                            family: 'Arial'
                        },
                        titleFont: {
                            size: 16,
                            family: 'Arial',
                            weight: 'bold'
                        },
                        backgroundColor: '#333333',
                        titleColor: '#ffffff',
                        bodyColor: '#ffffff'
                    }
                }
            }
        });


    // 将数据填充到指定的表格中
    window.onload = function() {
            // 创建一个新的 XMLHttpRequest 对象
        var xhr = new XMLHttpRequest();

        // 设置请求方法和URL
        xhr.open("GET", "http://127.0.0.1:8081/index_compare", true);

        // 设置回调函数，处理响应
        xhr.onreadystatechange = function() {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    // 请求成功，解析返回的 JSON 数据
                    var data = JSON.parse(xhr.responseText);
                    console.log(data.advanced)
                    // 填充到第一个表格
                    fillTable(data.advanced, "reportTable1");
                    fillTable(data.mean, "reportTable2");
                    fillTable(data.unqualified, "reportTable3");
                    var paragraph = document.getElementById("index1");
                    // 修改 <p> 元素的内容
                    paragraph.innerText = "达到中石化先进指标数："+data.advanced.length;
                    var paragraph = document.getElementById("index2");
                    // 修改 <p> 元素的内容
                    paragraph.innerText = "达到中石化平均指标数："+data.mean.length;
                    var paragraph = document.getElementById("index3");
                    // 修改 <p> 元素的内容
                    paragraph.innerText = "未达到中石化平均指标数："+data.unqualified.length;
                    var total=data.advanced.length+data.mean.length+data.unqualified.length
                    myPieChart.data.datasets[0].data = [data.advanced.length/total*100, data.mean.length/total*100, data.unqualified.length/total*100];
// 更新图表
                    myPieChart.update();
                    var paragraph = document.getElementById("indexall");
                    // 修改 <p> 元素的内容
                    paragraph.innerText = "综上分析，对标中石化生产指标，本系统得分："+data.score+"分";
                } else {
                    // 请求失败，显示错误信息
                    console.error("发生错误：" + xhr.status);
                }
            }
        };

        // 发送请求
        xhr.send();
        };

        // 将数据填充到指定的表格中
        function fillTable(data, tableId) {
        var table = document.getElementById(tableId);
        var tbody = table.getElementsByTagName("tbody")[0];
        tbody.innerHTML = ""; // 清空表格内容
        for (var i = 0; i < data.length; i++) {
            var row = "<tr>";
            row += "<td>" + i+ "</td>";
            row += "<td>" + data[i].类别 + "</td>";
            row += "<td>" + data[i].指标名称 + "</td>";
            row += "<td>" + "一级" + "</td>";
            row += "<td>" + data[i].油区系统一级指标实际值 + "</td>";
            row += "</tr>";
            tbody.innerHTML += row;
        }
        }
    </script>
</body>
</html>














